decisions = {
	
	form_ancient_children = {
		is_high_prio = yes
		ai_check_interval = 12
		#only_playable = yes
		
		potential = {
			has_landed_title = d_dragon_cult
			religion = dragon_cult
			age = 16
			NOT = { has_global_flag = children_of_the_ancient_ways_formed }
			NOT = { has_character_flag = society_open }
			has_submenu_open = no
		}
		
		allow = {
			war = no
			#is_in_society = no
			trait = dragonpriest
			OR = {
				ai = yes
				AND = {
					treasury = 300
					piety = 500
				}
			}
		}
		
		effect = {
			if = {
				limit = {
					ai = no
				}
				wealth = -300
				piety = -500
			}
			hidden_tooltip = { 
				set_global_flag = children_of_the_ancient_ways_formed
				if = {
					limit = {
						is_in_society = yes
					}
					leave_society = yes
				}
			}
			join_society = children_of_the_ancient_ways
			set_society_grandmaster = yes
		}
	}
	
	children_of_the_ancient_ways_hire_substitute_gm = {
		
		potential = {
			ai = no
			society_member_of = children_of_the_ancient_ways
			is_society_grandmaster = yes
			has_character_flag = society_open
			
			NOT = { has_global_flag = children_of_the_ancient_ways_substitute_gm_hired }
		}
		
		allow = {}
		
		effect = {
			set_global_flag = children_of_the_ancient_ways_substitute_gm_hired
			leave_society = yes
		}
	}
	
	children_of_the_ancient_ways_fire_substitute_gm = {
		
		potential = {
			ai = no
			has_landed_title = d_dragon_cult
			has_global_flag = children_of_the_ancient_ways_substitute_gm_hired
		}
		
		allow = {}
		
		effect = { clr_global_flag = children_of_the_ancient_ways_substitute_gm_hired }
	}
	
}

society_decisions = {
	
	request_to_rank_up_within_children_of_the_ancient_ways_society = {
		
		hide_in_decisions_list = yes
		
		potential = {
			hidden_tooltip = {
				society_rank <= 2 #is not max rank
				days_in_society > 365 #days requirement
				is_in_society = yes #obviously
				OR = { #Players can always rank up (if they have the power), AI won't if there is no room
					ai = no
					AND = {
						ai = yes
						society_can_rank_up = yes
					}
				}
			}
		}
		
		allow = {
			#Rank requirements. IMPORTANT!!! If you change the requirements, the customizable loc keys "GetAncientChildrenRankUpTooltip" 1, 2, 3, and 4 must be updated, as it displays these requirements.
			custom_tooltip = { # Sufficient currency
				text = request_to_rank_up_within_children_of_the_ancient_ways_tt
				OR = {
					AND = {
						society_rank == 1
						society_currency >= 750
					}
					AND = {
						society_rank == 2
						society_currency >= 1000
					}
					AND = {
						society_rank == 3
						society_currency >= 2000
					}
				}
			}

			custom_tooltip = {
				text = must_not_have_sent_request_already_tooltip 
				NOT = { has_character_flag = has_sent_request_to_rank_up }
			}

			custom_tooltip = {
				text = must_be_allowed_to_rank_up_tooltip 
				days_at_current_society_rank >= 1095 #IMPORTANT! Update tooltip.
			}

			custom_tooltip = {
				text = must_have_grandmaster_tooltip #You must have a grand master
				any_society_member = {
					is_society_grandmaster = yes
					same_society_as = ROOT
				}
			}
		}
		
		effect = {
			#Rank up cost
			if = {
				limit = { society_rank == 1 }
				change_society_currency = -750
			}
			if = {
				limit = { society_rank == 2 }
				change_society_currency = -1000
			}
			if = {
				limit = { society_rank == 3 }
				change_society_currency = -2000
			}

			#Perform rank up
			hidden_tooltip = {
				save_event_target_as = rank_up_target #mark the character as the one ranking up
				set_character_flag = has_sent_request_to_rank_up
				character_event = { id = ancient_children.120 days = 20 random = 10 } # sends hidden delayed event to self, which then sends request to Leader of the society
				
			}
		}
		
		revoke_allowed = {
			always = no
		}
		
		ai_will_do = {
			factor = 1
		}
	}
	
	study_specialization_children_of_the_ancient_ways = {
		is_high_prio = yes #There's really no reason a person who could be studying a specialization shouldn't be studying a specialization.
		ai_check_interval = 12
		
		potential = {
			society_member_of = children_of_the_ancient_ways
			has_maxed_specializations = no
			is_indisposed = no
			block_general_event_trigger = no
			OR = {
				has_character_flag = society_open
				ai = yes
			}
			NOT = { has_character_flag = soul_sold }
			NOT = { has_character_flag = children_of_the_ancient_ways_specialization_ongoing }
			NOT = { has_character_modifier = denied_specialization_timer }
			OR = {
				is_undead = no
				AND = {
					is_undead = yes
					trait = vampire
				}
				AND = {
					is_undead = yes
					trait = lich
				}
			}
		}
		
		effect = {
			set_character_flag = children_of_the_ancient_ways_specialization_ongoing
			if = {
				limit = { ai = no }
				character_event = { id = ancient_children.200 }
			}
			if = {
				limit = { ai = yes }
				character_event = { id = ancient_children.210 }
			}
		}
	}
	
	cancel_specialization_children_of_the_ancient_ways = {
		ai_check_interval = 6000
		
		potential = {
			ai = no
			society_member_of = children_of_the_ancient_ways
			has_character_flag = children_of_the_ancient_ways_specialization_ongoing
			is_indisposed = no
			block_general_event_trigger = no
			has_character_flag = society_open
			NOT = { has_character_flag = soul_sold }
			OR = {
				is_undead = no
				AND = {
					is_undead = yes
					trait = vampire
				}
				AND = {
					is_undead = yes
					trait = lich
				}
			}
		}
		effect = {
			character_event = { id = ancient_children.220 }
		}

	}
	
	ancient_children_purchase_techpoints_decision = {
		only_playable = yes
		ai_check_interval = 120
		
		potential = {
			society_member_of = children_of_the_ancient_ways
			society_rank >= 2
			is_indisposed = no
			block_general_event_trigger = no
			OR = {
				has_character_flag = society_open
				ai = yes
			}
			NOT = { has_character_flag = exchanging_influence_for_tech }
		}
		allow = {
			NOT = { has_character_modifier = society_advancements_purchased }
			has_society_currency_major_trigger_scaling = yes
		}
		effect = {
			character_event = { id = ancient_children.250 }
			set_character_flag = exchanging_influence_for_tech
			tooltip = {
				detract_society_currency_major_effect_scaling = yes
			}
			custom_tooltip = { text = reimbursed_if_cancelled }
		}

		ai_will_do = {
			factor = 1
			
			modifier = {
				factor = 0.1
			}
			modifier = {
				factor = 10
				society_currency >= 3000
			}
		}
	}
	
	ancient_children_request_grandmaster_retire = {
		ai_check_interval = 60
		
		potential = {
			society_member_of = children_of_the_ancient_ways
			society_rank == 3
			is_indisposed = no
			block_general_event_trigger = no
			OR = {
				has_character_flag = society_open
				ai = yes
			}
		}
		allow = {
			wealth = 750
			trait = dragonpriest
			NOT = { has_character_flag = requesting_society_retirement }
			custom_tooltip = {
				text = society_grandmaster_retirment_not_already_asked_or_denied
				hidden_tooltip = {
					society_member_of = children_of_the_ancient_ways
					any_society_member = {
						society_member_of = children_of_the_ancient_ways
						is_society_grandmaster = no
						NOT = { has_character_flag = requesting_society_retirement }
					}
					any_society_member = {
						society_member_of = children_of_the_ancient_ways
						is_society_grandmaster = yes
						NOT = { has_character_modifier = denied_retirement_timer }
					}
				}
			}
		}
		effect = {
			set_character_flag = requesting_society_retirement
			wealth = -750
			if = {
				limit = {
					society_member_of = children_of_the_ancient_ways
				}
				random_society_member = {
					limit = {
						society_member_of = children_of_the_ancient_ways
						is_society_grandmaster = yes
					}
					letter_event = { id = eksocieties.20 days = 3 }
				}
			}
		}
	}
}