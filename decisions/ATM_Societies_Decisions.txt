decisions = {

	study_specialization_atmora = {
		is_high_prio = yes 
		ai_check_interval = 12
		
		potential = {
			OR = {
				society_member_of = bear_guild
				society_member_of = owl_guild
			}
			has_maxed_specializations = no
			is_indisposed = no
			block_general_event_trigger = no
			OR = {
				has_character_flag = society_open
				ai = yes
			}
			NOT = { has_character_flag = soul_sold }
			NOT = { has_character_flag = guild_specialization_ongoing }
			NOT = { has_character_modifier = denied_specialization_timer }
			OR = {
				is_undead = no
				AND = {
					is_undead = yes
					trait = vampire
				}
			}
		}
		effect = {
			set_character_flag = guild_specialization_ongoing
			if = {
				limit = { ai = no }
				character_event = { id = ATMSocieties.09 }
			}
			if = {
				limit = { ai = yes }
				character_event = { id = ATMSocieties.13 }
			}
		}
		revoke_allowed = {
			always = no
		}
	}

	cancel_specialization_atmora = {
		ai_check_interval = 6000
		
		potential = {
			ai = no
			OR = {
				society_member_of = bear_guild
				society_member_of = owl_guild
			}
			has_character_flag = guild_specialization_ongoing
			is_indisposed = no
			block_general_event_trigger = no
			has_character_flag = society_open
			NOT = { has_character_flag = soul_sold }
			OR = {
				is_undead = no
				AND = {
					is_undead = yes
					trait = vampire
				}
			}
		}
		effect = {
			character_event = { id = ATMSocieties.14 }
		}
		revoke_allowed = {
			always = no
		}
	}
	
	choose_lifestyle_guild_raiders = {
		ai_check_interval = 12
		
		potential = {
			is_playable = yes
			is_adult = yes
			society_member_of = bear_guild
			society_rank >= 3
			NOT = { has_character_flag = choosing_lifestyle_society }
			OR = {
				has_character_flag = society_open
				ai = yes
			}
		}
		
		allow = {
			has_society_currency_medium_trigger = yes
			NOT = { has_character_flag = choosing_lifestyle_society }
			
			OR = {
				custom_tooltip = {
					text = does_not_have_a_lifestyle_trait_tt
					NOT = { lifestyle_traits = 1 }
				}
				trait = gladiator
				trait = equestrian
				trait = blacksmith
			}
		}
		
		effect = {
			hidden_tooltip = {
				character_event = { id = societieslifestyle.1 }
			}
			set_character_flag = choosing_lifestyle_society
		}
		
		revoke_allowed = { always = no }

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				lifestyle_traits = 1
			}
		}
	}
	
	choose_lifestyle_guild_storytellers = {
		ai_check_interval = 12
		
		potential = {
			is_playable = yes
			is_adult = yes
			society_member_of = owl_guild
			society_rank >= 3
			
			NOT = { has_character_flag = choosing_lifestyle_society }
			
			OR = {
				has_character_flag = society_open
				ai = yes
			}
		}
		
		allow = {
			has_society_currency_medium_trigger = yes
			NOT = { has_character_flag = choosing_lifestyle_society }
			
			OR = {
				custom_tooltip = {
					text = does_not_have_a_lifestyle_trait_tt
					NOT = { lifestyle_traits = 1 }
				}
				trait = musician
				trait = painter
				trait = magician
			}
		}
		
		effect = {
			hidden_tooltip = {
				character_event = { id = societieslifestyle.11 }
			}
			set_character_flag = choosing_lifestyle_society
		}
		
		revoke_allowed = { always = no }

		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0
				lifestyle_traits = 1
			}
		}
	}
	
}

society_decisions = {
	
	atmoran_sacrifice = {
		is_in_society = yes
		ai_check_interval = 6 #check only once every 6 months.
		potential = {
			is_playable = yes
			is_adult = yes
			society_member_of = bear_guild
			society_rank >= 2
			has_character_flag = society_open
			OR = {
				ai = no
				any_war = {
					OR = {
						any_defender = {
							character = ROOT
							is_primary_war_defender = yes
						}
						any_attacker = {
							character = ROOT
							is_primary_war_attacker = yes
						}
					}
				}
			}
		}
		allow = {
			has_society_currency_medium_trigger = yes
			is_inaccessible_trigger = no
			NOT = { trait = incapable }
			custom_tooltip = { 
				text = tooltip_war_sacrifice_cooldown
				hidden_tooltip = { 
					NOR = { 
						has_character_modifier = lodge_war_sacrifice_cooldown
						has_character_flag = flag_picking_war_sacrifice
					} 
				} 
			}
		}
		effect = {
			detract_society_currency_medium_effect = yes
			custom_tooltip = { text = tooltip_lodge_war_sacrifice }
			set_character_flag = flag_picking_war_sacrifice
			hidden_tooltip = { 
				character_event = { id = ATMSocieties.19 }
			}
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 0.1
			modifier = { 
				factor = 10
				any_war = {
					defender = { character = ROOT }
					attacker = {
						war_score = -50
					}
				}
			}
			modifier = {
				factor = 3
				trait = brave
			}
		}
	}

	Raider_Request_To_Rank_Up_Within_Society = {
		hide_in_decisions_list = yes
		ai_check_interval = 24
		potential = {
			hidden_tooltip = {
				is_in_society = yes
				society_member_of = bear_guild
				OR = {
					society_rank < 2
					society_rank < 3
					society_rank < 4
				}
				days_in_society > 365
				OR = {
					ai = no
					AND = {
						ai = yes
						society_can_rank_up = yes
					}
				}
			}
		}
		
		allow = {
			custom_tooltip = {
				text = ATM_request_to_rank_up_within_society_currency_tt
				OR = {
					AND = {
						is_long_lived = no
						AND = {
							society_rank == 1
							society_currency >= 750
						}
					}
					AND = {
						is_long_lived = yes
						AND = {
							society_rank == 1
							society_currency >= 2250
						}
					}
					AND = {
						is_long_lived = no
						AND = {
							society_rank == 2
							society_currency >= 1000
						}
					}
					AND = {
						is_long_lived = yes
						AND = {
							society_rank == 2
							society_currency >= 3000
						}
					}
					AND = {
						is_long_lived = no
						AND = {
							society_rank == 3
							society_currency >= 1500
						}
					}
					AND = {
						is_long_lived = yes
						AND = {
							society_rank == 3
							society_currency >= 4500
						}
					}
				}
			}
		
			custom_tooltip = {
				text = must_not_have_sent_request_already_tooltip 
				NOT = { has_character_flag = has_sent_request_to_rank_up }
			}
		
			custom_tooltip = {
				text = must_be_allowed_to_rank_up_tooltip 
				days_at_current_society_rank >= 1095 #IMPORTANT! Update tooltip.
			}
		
			custom_tooltip = {
				text = must_have_grandmaster_tooltip
				any_society_member = {
					is_society_grandmaster = yes
					same_society_as = ROOT
				}
			}
		}
	
		effect = {
			if = {
				limit = {
					is_long_lived = no
					society_rank == 1
				}
				change_society_currency = -750
			}
			if = {
				limit = {
					is_long_lived = yes
					society_rank == 1
				}
				change_society_currency = -2250
			}
			if = {
				limit = {
					is_long_lived = no
					society_rank == 2
				}
				change_society_currency = -1000
			}
			if = {
				limit = {
					is_long_lived = yes
					society_rank == 2
				}
				change_society_currency = -3000
			}
			if = {
				limit = {
					is_long_lived = no
					society_rank == 3
				}
				change_society_currency = -1500
			}
			if = {
				limit = {
					is_long_lived = yes
					society_rank == 3
				}
				change_society_currency = -4500
			}
			hidden_tooltip = {
				save_event_target_as = rank_up_target
				set_character_flag = has_sent_request_to_rank_up
				character_event = { id = ATMSocieties.20 days = 20 random = 10 }
			}
		}
	}
	
	Storyteller_Request_To_Rank_Up_Within_Society = {
		hide_in_decisions_list = yes
		ai_check_interval = 24
		potential = {
			hidden_tooltip = {
				is_in_society = yes
				society_member_of = owl_guild
				OR = {
					society_rank < 2
					society_rank < 3
					AND = {
						society_rank < 4
						NOT = {
							is_society_rank_full = {
								society = owl_guild
								rank = 4
							}
						}
					}
				}
				days_in_society > 365
				OR = {
					ai = no
					AND = {
						ai = yes
						society_can_rank_up = yes
					}
				}
			}
		}
	
		allow = {
			custom_tooltip = {
				text = ATM_request_to_rank_up_within_society_currency_tt
				OR = {
					AND = {
						is_long_lived = no
						AND = {
							society_rank == 1
							society_currency >= 750
						}
					}
					AND = {
						is_long_lived = yes
						AND = {
							society_rank == 1
							society_currency >= 2250
						}
					}
					AND = {
						is_long_lived = no
						AND = {
							society_rank == 2
							society_currency >= 1000
						}
					}
					AND = {
						is_long_lived = yes
						AND = {
							society_rank == 2
							society_currency >= 3000
						}
					}
					AND = {
						is_long_lived = no
						AND = {
							society_rank == 3
							society_currency >= 1500
						}
					}
					AND = {
						is_long_lived = yes
						AND = {
							society_rank == 3
							society_currency >= 4500
						}
					}
				}
			}
			
			custom_tooltip = {
				text = must_not_have_sent_request_already_tooltip 
				NOT = { has_character_flag = has_sent_request_to_rank_up }
			}

			custom_tooltip = {
				text = must_be_allowed_to_rank_up_tooltip 
				days_at_current_society_rank >= 1095 #IMPORTANT! Update tooltip.
			}

			custom_tooltip = {
				text = must_have_grandmaster_tooltip
				any_society_member = {
					is_society_grandmaster = yes
					same_society_as = ROOT
				}
			}
			
			trigger_if = {
				limit = {
					AND = {
						is_in_society = yes
						society_member_of = owl_guild
						rank == 3
					}
				}
				custom_tooltip = {
					text = NUMBEROFSKALDS
					NOT = {
						is_society_rank_full = {
							society = owl_guild
							rank = 4
						}
					}
				}
			}
		}
	
		effect = {
			if = {
				limit = {
					is_long_lived = no
					society_rank == 1
				}
				change_society_currency = -750
			}
			if = {
				limit = {
					is_long_lived = yes
					society_rank == 1
				}
				change_society_currency = -2250
			}
			if = {
				limit = {
					is_long_lived = no
					society_rank == 2
				}
				change_society_currency = -1000
			}
			if = {
				limit = {
					is_long_lived = yes
					society_rank == 2
				}
				change_society_currency = -3000
			}
			if = {
				limit = {
					is_long_lived = no
					society_rank == 3
				}
				change_society_currency = -1500
			}
			if = {
				limit = {
					is_long_lived = yes
					society_rank == 3
				}
				change_society_currency = -4500
			}
			hidden_tooltip = {
				save_event_target_as = rank_up_target
				set_character_flag = has_sent_request_to_rank_up
				character_event = { id = ATMSocieties.20 days = 20 random = 10 }
			}
		}
	}

	atm_request_grandmaster_retire = {
		ai_check_interval = 60
		
		potential = {
			OR = {
				AND = {
					society_member_of = bear_guild
					society_rank == 4
				}
				AND = {
					society_member_of = owl_guild
					society_rank == 3
					is_society_rank_full = {
						society = owl_guild
						rank = 4
					}
				}
			}
			is_indisposed = no
			block_general_event_trigger = no
			OR = {
				has_character_flag = society_open
				ai = yes
			}
		}
		
		allow = {
			wealth = 750
			NOT = { has_character_flag = requesting_society_retirement }
			custom_tooltip = {
				text = society_grandmaster_retirment_not_already_asked_or_denied
				hidden_tooltip = {
					OR = {
						AND = {
							society_member_of = bear_guild
							any_society_member = {
								society_member_of = bear_guild
								is_society_grandmaster = no
								NOT = { has_character_flag = requesting_society_retirement }
							}
							any_society_member = {
								society_member_of = bear_guild
								is_society_grandmaster = yes
								NOT = { has_character_modifier = denied_retirement_timer }
							}
						}
						AND = {
							society_member_of = owl_guild
							any_society_member = {
								society_member_of = owl_guild
								is_society_grandmaster = no
								NOT = { has_character_flag = requesting_society_retirement }
							}
							any_society_member = {
								society_member_of = fighters_guild_akavir
								is_society_grandmaster = yes
								NOT = { has_character_modifier = denied_retirement_timer }
							}
						}
					}
				}
			}
		}
	
		effect = {
			set_character_flag = requesting_society_retirement
			wealth = -750
			if = {
				limit = {
					society_member_of = bear_guild
				}
				random_society_member = {
					limit = {
						society_member_of = bear_guild
						is_society_grandmaster = yes
					}
					letter_event = { id = eksocieties.20 days = 3 }
				}
			}
			if = {
				limit = {
					society_member_of = owl_guild
				}
				random_society_member = {
					limit = {
						society_member_of = owl_guild
						is_society_grandmaster = yes
					}
					letter_event = { id = eksocieties.20 days = 3 }
				}
			}
		}
	}
}

targetted_decisions = {
	
	join_the_bear_guild = {
		filter = home_court
		ai_target_filter = home_court
		ai_check_interval = 36		
		from_potential = {
			is_playable = yes
			NOT = { has_character_flag = spellbook_open }
		}
		potential = {
			can_join_society = bear_guild
		}
		allow = {}
		effect = {
			join_society = bear_guild
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 1
			
			modifier = {
				factor = 0
				NOR = {
					is_friend = FROM
					is_lover = FROM
					is_close_relative = FROM
				}
			}
			
			modifier = {
				factor = 0.05
			}
		}
	}
	
	join_the_owl_guild = {
		filter = home_court
		ai_target_filter = home_court
		ai_check_interval = 36
		from_potential = {
			is_playable = yes
			NOT = { has_character_flag = spellbook_open }
		}
		potential = {
			can_join_society = owl_guild
		}
		allow = {}
		effect = {
			join_society = owl_guild
		}
		revoke_allowed = {
			always = no
		}
		ai_will_do = {
			factor = 1
			
			modifier = {
				factor = 0
				NOR = {
					is_friend = FROM
					is_lover = FROM
					is_close_relative = FROM
				}
			}
			
			modifier = {
				factor = 0.05
			}
		}
	}
}