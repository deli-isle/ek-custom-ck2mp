namespace = dovah_in_soci

########################JOINING############################

#From on_character_ask_to_join_society
character_event = {
    id = dovah_in_soci.100
	hide_window = yes
    is_triggered_only = yes
	
    trigger = {
    	FROM = { leader = { society_member_of = dovah_in_society } }
    }
    immediate = {
    	FROM = { leader = { character_event = { id = dovah_in_soci.101 } } } #target is the leader of the society
    }
}

#Ping event
character_event = {
    id = dovah_in_soci.101
	hide_window = yes
    is_triggered_only = yes
    immediate = {
    	FROM = { letter_event = { id = dovah_in_soci.102 } } #send event back 
    }
}

#Welcome letter
letter_event = {
    id = dovah_in_soci.102
    desc = EVTDESC_dovah_in_soci.102
    border = GFX_event_letter_frame_war
	
    is_triggered_only = yes

    option = { #join the society
        name = EVTOPTA_dovah_in_soci.102
		join_society = dovah_in_society
    }
    option = { #don't
        name = EVTOPTB_dovah_in_soci.102
    }
}

########################AI JOIN AND AI RANK UP###########################

character_event = { #force the AI to join a society, triggered by on_action
	id = dovah_in_soci.110
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { #if he's already a member, will force a rank up 25% of the time
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
				society_member_of = dovah_in_society
				society_rank <= 2
				society_can_rank_up = yes
			}
			random_list = {
				75 = {}
				25 = {
					society_rank_up = 1					
				}
			}
		}
		any_courtier = {  #if you want courtier in the society enable this part
			limit = {
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
				is_adult = yes
				is_in_society = no
				controls_religion = no
				NOT = { trait = sload }
				is_inaccessible_trigger = no
				OR = {
					is_not_undead = yes
					trait = vampire
					AND = {
						trait = lich
						religion = dragon_cult
					}
					trait = dragonpriest
				}
				block_general_event_trigger = no
			}
			character_event = { id = dovah_in_soci.111 }
		}
		if = { #force the joining event on AI
			limit = {
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
				is_adult = yes
				is_in_society = no
				controls_religion = no
				block_general_event_trigger = no
				NOT = { trait = sload }
				is_inaccessible_trigger = no
				OR = {
					is_not_undead = yes
					trait = vampire
					trait = lich
					trait = dragonpriest
				}
			}
			character_event = { id = dovah_in_soci.111 }
		}
	}
}

character_event = { #AI join event
	id = dovah_in_soci.111
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			90 = { # do nothing
			}
			10 = { # try to join a society 10% of the time
				trigger = { #meet the requirement
					can_join_society = dovah_in_society
				}
				modifier = { #things that will make that 10% of the time bigger, can be anything 
					factor = 2
					prestige = 200
				}
				join_society = dovah_in_society #join the society
				if = { # Make grandmaster is there is none
					limit = {
						NOT = {
							society = {
								any_society_member = {
									is_society_grandmaster = yes
								}
							}
						}
					}
					set_society_grandmaster = yes
				}
			}
		}
	}
}

#######################Rank UP#############################

# Hidden start: Send the rank-up request to the current Grandmaster (delayed event on self, from decision to rank up)
character_event = {
	id = dovah_in_soci.120

	hide_window = yes

	trigger = { #has pressed the button
		has_character_flag = has_sent_request_to_rank_up
	}
	
	is_triggered_only = yes

	immediate = {
		if = { #if he's still a member
			limit = { is_in_society = yes }
			random_society_member = { #will send the request to a random top rank member of the same society
				limit = {
					is_society_grandmaster = yes
					same_society_as = ROOT
				}
				character_event = { id = dovah_in_soci.121 } # send request to Grand Master.
			}
		}
		if = { #if he's not a member
			limit = { is_in_society = no }
			clr_character_flag = has_sent_request_to_rank_up
		}
	}
}

# Grandmaster gets the rank-up request
character_event = {
	id = dovah_in_soci.121
	
	hide_window = yes

	is_triggered_only = yes

	immediate = {
		event_target:rank_up_target = { letter_event = { id = dovah_in_soci.122 } } #send it back
	}
}

#Grand master approves my request
letter_event = {
	id = dovah_in_soci.122
	desc = EVTDESC_dovah_in_soci.122
	border = GFX_event_letter_frame_war

	trigger = {
		society_rank < 3 #cannot rank up past 4
		has_character_flag = has_sent_request_to_rank_up
	}
	
	is_triggered_only = yes

	#Rank up approved
	option = {
		name = EVTOPTA_ancient_children.122
		if = { limit = { society_rank < 3 } #if not max rank, rank up
			society_rank_up = 1
		}
		clr_character_flag = has_sent_request_to_rank_up
	}
}

#######################Grandmaster Cleanup#############################

character_event = { #Invalid grandmaster
	id = dovah_in_soci.300
	hide_window = yes
	
	trigger = {
		NOT = { has_global_flag = dovah_in_society_invalid_grandmaster }
		society_member_of = dovah_in_society
		is_society_grandmaster = yes
		NOT = { has_landed_title = d_dovah_in }
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		set_global_flag = dovah_in_society_invalid_grandmaster
	}
}

character_event = { #Promotes valid grandmaster
	id = dovah_in_soci.301
	hide_window = yes
	
	trigger = {
		has_global_flag = dovah_in_society_invalid_grandmaster
		has_landed_title = d_dovah_in
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		if = {
			limit = {
				is_in_society = yes
				NOT = { society_member_of = dovah_in_society }
			}
			leave_society = yes
			join_society = dovah_in_society
		}
		if = {
			limit = {
				is_in_society = no
			}
			join_society = dovah_in_society
		}
		set_society_grandmaster = yes
		clr_global_flag = dovah_in_society_invalid_grandmaster
		
		add_trait = dragonpriest
		add_trait = lich
		remove_trait = bard_1
		remove_trait = bard_2
		remove_trait = bard_3
		remove_trait = wayfarer_1
		remove_trait = wayfarer_2
		remove_trait = wayfarer_3
		remove_trait = savant_1
		remove_trait = savant_2
		remove_trait = savant_3
		remove_trait = rogue_1
		remove_trait = rogue_2
		remove_trait = rogue_3
		remove_trait = knight_1
		remove_trait = knight_2
		remove_trait = knight_3
		remove_trait = crusader_1
		remove_trait = crusader_2
		remove_trait = crusader_3
		remove_trait = barbarian_1
		remove_trait = barbarian_2
		remove_trait = barbarian_3
		remove_trait = spellsword_1
		remove_trait = spellsword_2
		remove_trait = spellsword_3		
		remove_trait = witchhunter_1
		remove_trait = witchhunter_2
		remove_trait = witchhunter_3
		remove_trait = battlemage_1
		remove_trait = battlemage_2
		remove_trait = battlemage_3
		remove_trait = sorcerer_1
		remove_trait = sorcerer_2
		remove_trait = sorcerer_3
		remove_trait = trader_1
		remove_trait = trader_2
		remove_trait = trader_3	
		remove_trait = monk_1
		remove_trait = monk_2
		remove_trait = monk_3
		remove_trait = scout_1
		remove_trait = scout_2
		remove_trait = scout_3
		remove_trait = healer_1
		remove_trait = healer_2
		remove_trait = healer_3	
		remove_trait = acrobat_1
		remove_trait = acrobat_2
		remove_trait = acrobat_3	
		remove_trait = thief_1
		remove_trait = thief_2
		remove_trait = thief_3
		remove_trait = assassin_1
		remove_trait = assassin_2
		remove_trait = assassin_3	
		remove_trait = nightblade_1
		remove_trait = nightblade_2
		remove_trait = nightblade_3
		if = {
			limit = {
				OR = {
					trait = priest_1
					trait = priest_2
				}
			}
			remove_trait = priest_1
			remove_trait = priest_2
			add_trait = priest_3
		}
		if = {
			limit = {
				NOR = {
					trait = priest_1
					trait = priest_2
					trait = priest_3
				}
			}
			add_trait = priest_3
		}
		hidden_tooltip = { set_character_flag = dragonborn_candidate }
	}
}

character_event = { #Granmaster made Dragonpriest
	id = dovah_in_soci.302
	hide_window = yes
	
	trigger = {
		society_member_of = dovah_in_society
		is_society_grandmaster = yes
		has_landed_title = d_dovah_in
		NOR = {
			trait = dragonpriest
			trait = lich
		}
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		if = {
			limit = {
				NOT = { trait = dragonpriest }
			}
			add_trait = dragonpriest
		}
		if = {
			limit = {
				NOT = { trait = lich }
			}
			add_trait = lich
		}
		hidden_tooltip = { set_character_flag = dragonborn_candidate }
	}
}

#######################Powers#############################

character_event = { #Study a Specilization
	id = dovah_in_soci.200
	picture = GFX_evt_dragon_temple
	desc = EVTDESC_dovah_in_soci.200
	
	is_triggered_only = yes
	
	min_age = 16
	capable_only = yes
	prisoner = no
	
	trigger = {
		is_in_society = yes
		society_member_of = dovah_in_society
		NOT = { has_character_modifier = denied_specialization_timer }
		NOT = {
			calc_true_if = {
				amount = 2
				trait = acrobat_3
				trait = assassin_3
				trait = barbarian_3
				trait = bard_3
				trait = battlemage_3
				trait = crusader_3
				trait = knight_3
				trait = healer_3
				trait = monk_3
				trait = nightblade_3
				trait = priest_3
				trait = rogue_3
				trait = savant_3
				trait = scout_3
				trait = sorcerer_3
				trait = spellsword_3
				trait = thief_3
				trait = trader_3
				trait = wayfarer_3
				trait = witchhunter_3
			}
		}
	}
	
	option = { #Rogue
		name = EVTOPTA_dovah_in_soci.200
		trigger = {
			society_member_of = dovah_in_society
			OR = {
				trait = rogue_1
				trait = rogue_2
				NOR = {
					trait = rogue_3
					has_two_specializations = yes
				}
			}
		}
		custom_tooltip = { text = rogue_study_tooltip }
		set_character_flag = dovah_in_society_rogue
	}
	
	option = { #Knight
		name = EVTOPTB_dovah_in_soci.200
		trigger = {
			society_member_of = dovah_in_society
			OR = {
				trait = knight_1
				trait = knight_2
				NOR = {
					trait = knight_3
					has_two_specializations = yes
				}
			}
		}
		custom_tooltip = { text = knight_study_tooltip }
		set_character_flag = dovah_in_society_knight
	}
	
	option = { #Crusader
		name = EVTOPTC_dovah_in_soci.200
		trigger = {
			society_member_of = dovah_in_society
			OR = {
				trait = crusader_1
				trait = crusader_2
				NOR = {
					trait = crusader_3
					has_two_specializations = yes
				}
			}
		}
		custom_tooltip = { text = crusader_study_tooltip }
		set_character_flag = dovah_in_society_crusader
	}
	
	option = {
		name = eksocieties50Completed
		trigger = { 
			calc_true_if = {
				amount = 2
				trait = acrobat_3
				trait = assassin_3
				trait = barbarian_3
				trait = bard_3
				trait = battlemage_3
				trait = crusader_3
				trait = knight_3
				trait = healer_3
				trait = monk_3
				trait = nightblade_3
				trait = priest_3
				trait = rogue_3
				trait = savant_3
				trait = scout_3
				trait = sorcerer_3
				trait = spellsword_3
				trait = thief_3
				trait = trader_3
				trait = wayfarer_3
				trait = witchhunter_3
			}
		}
	}
	
	option = { #More options
		name = eksocieties50Wrap
		character_event = { id = dovah_in_soci.201 }
	}
}

character_event = { #More Options
	id = dovah_in_soci.201
	desc = EVTDESC_dovah_in_soci.200
	picture = GFX_evt_dragon_temple
	
	is_triggered_only = yes
	
	option = { #Barbarian
		name = EVTOPTA_dovah_in_soci.201
		trigger = {
			society_member_of = dovah_in_society
			OR = {
				trait = barbarian_1
				trait = barbarian_2
				NOR = {
					trait = barbarian_3
					has_two_specializations = yes
				}
			}
		}
		custom_tooltip = { text = barbarian_study_tooltip }
		set_character_flag = dovah_in_society_barbarian
	}
	
	option = { #Spellsword
		name = EVTOPTB_dovah_in_soci.201
		trigger = {
			society_member_of = dovah_in_society
			OR = {
				trait = spellsword_1
				trait = spellsword_2
				NOR = {
					trait = spellsword_3
					has_two_specializations = yes
				}
			}
		}
		custom_tooltip = { text = spellsword_study_tooltip }
		set_character_flag = dovah_in_society_spellsword
	}
	
	option = { #Priest
		name = EVTOPTC_dovah_in_soci.201
		trigger = {
			society_member_of = dovah_in_society
			OR = {
				trait = priest_1
				trait = priest_2
				NOR = {
					trait = priest_3
					has_two_specializations = yes
				}
			}
		}
		custom_tooltip = { text = priest_study_tooltip }
		set_character_flag = dovah_in_society_priest
	}
	
	option = {
		name = eksocieties50Completed
		trigger = { 
			calc_true_if = {
				amount = 2
				trait = acrobat_3
				trait = assassin_3
				trait = barbarian_3
				trait = bard_3
				trait = battlemage_3
				trait = crusader_3
				trait = knight_3
				trait = healer_3
				trait = monk_3
				trait = nightblade_3
				trait = priest_3
				trait = rogue_3
				trait = savant_3
				trait = scout_3
				trait = sorcerer_3
				trait = spellsword_3
				trait = thief_3
				trait = trader_3
				trait = wayfarer_3
				trait = witchhunter_3
			}
		}
	}
	
	option = { #More options
		name = eksocieties50Wrap
		character_event = { id = dovah_in_soci.202 }
	}
}

character_event = { #More Options Again
	id = dovah_in_soci.202
	desc = EVTDESC_dovah_in_soci.200
	picture = GFX_evt_dragon_temple
	
	is_triggered_only = yes
	
	option = { #Battlemage
		name = EVTOPTA_dovah_in_soci.202
		trigger = {
			society_member_of = dovah_in_society
			OR = {
				trait = battlemage_1
				trait = battlemage_2
				NOR = {
					trait = battlemage_3
					has_two_specializations = yes
				}
			}
		}
		custom_tooltip = { text = battlemage_study_tooltip }
		set_character_flag = dovah_in_society_battlemage
	}
	
	option = { #Scout
		name = EVTOPTB_dovah_in_soci.202
		trigger = {
			society_member_of = dovah_in_society
			OR = {
				trait = scout_1
				trait = scout_2
				NOR = {
					trait = scout_3
					has_two_specializations = yes
				}
			}
		}
		custom_tooltip = { text = scout_study_tooltip }
		set_character_flag = dovah_in_society_scout
	}
	
	option = { #Assassin
		name = EVTOPTC_dovah_in_soci.202
		trigger = {
			society_member_of = dovah_in_society
			OR = {
				trait = assassin_1
				trait = assassin_2
				NOR = {
					trait = assassin_3
					has_two_specializations = yes
				}
			}
		}
		custom_tooltip = { text = assassin_study_tooltip }
		set_character_flag = dovah_in_society_assassin
	}
	
	option = {
		name = eksocieties50Completed
		trigger = { 
			calc_true_if = {
				amount = 2
				trait = acrobat_3
				trait = assassin_3
				trait = barbarian_3
				trait = bard_3
				trait = battlemage_3
				trait = crusader_3
				trait = knight_3
				trait = healer_3
				trait = monk_3
				trait = nightblade_3
				trait = priest_3
				trait = rogue_3
				trait = savant_3
				trait = scout_3
				trait = sorcerer_3
				trait = spellsword_3
				trait = thief_3
				trait = trader_3
				trait = wayfarer_3
				trait = witchhunter_3
			}
		}
		clr_character_flag = dovah_in_society_specialization_ongoing
	}
	
	option = { #More options
		name = eksocieties50Wrap
		character_event = { id = dovah_in_soci.200 }
	}
	
	option = { #Failsafe
		name = eksocieties50Decline
		trigger = {
		}
		clr_character_flag = dovah_in_society_specialization_ongoing
		add_character_modifier = {
			name = denied_specialization_timer
			months = 12
			hidden = yes
		}
	}
}

character_event = { #Specilizations for the AI
	id = dovah_in_soci.210
	hide_window = yes
	
	is_triggered_only = yes
	
	ai = yes
	min_age = 16
	capable_only = yes
	prisoner = no
	
	trigger = {
		is_in_society = yes
		society_member_of = dovah_in_society
		
		NOT = {
			calc_true_if = {
				amount = 2
				trait = acrobat_3
				trait = assassin_3
				trait = barbarian_3
				trait = bard_3
				trait = battlemage_3
				trait = crusader_3
				trait = knight_3
				trait = healer_3
				trait = monk_3
				trait = nightblade_3
				trait = priest_3
				trait = rogue_3
				trait = savant_3
				trait = scout_3
				trait = sorcerer_3
				trait = spellsword_3
				trait = thief_3
				trait = trader_3
				trait = wayfarer_3
				trait = witchhunter_3
			}
		}
	}
	
	immediate = {
		random_list = {
			10 = {
				modifier = {
					factor = 0
					OR = {
						trait = rogue_3
						AND = {
							has_two_specializations = yes
							NOR = {
								trait = rogue_1
								trait = rogue_2
							}
						}
					}
				}
				set_character_flag = dovah_in_society_rogue
			}
			10 = {
				modifier = {
					factor = 0
					OR = {
						trait = knight_3
						AND = {
							has_two_specializations = yes
							NOR = {
								trait = knight_1
								trait = knight_2
							}
						}
					}
				}
				set_character_flag = dovah_in_society_knight
			}
			10 = {
				modifier = {
					factor = 0
					OR = {
						trait = crusader_3
						AND = {
							has_two_specializations = yes
							NOR = {
								trait = crusader_1
								trait = crusader_2
							}
						}
					}
				}
				set_character_flag = dovah_in_society_crusader
			}
			10 = {
				modifier = {
					factor = 0
					OR = {
						trait = barbarian_3
						AND = {
							has_two_specializations = yes
							NOR = {
								trait = barbarian_1
								trait = barbarian_2
							}
						}
					}
				}
				set_character_flag = dovah_in_society_barbarian
			}
			10 = {
				modifier = {
					factor = 0
					OR = {
						trait = priest_3
						AND = {
							has_two_specializations = yes
							NOR = {
								trait = priest_1
								trait = priest_2
							}
						}
					}
				}
				set_character_flag = dovah_in_society_priest
			}
			10 = {
				modifier = {
					factor = 0
					OR = {
						trait = spellsword_3
						AND = {
							has_two_specializations = yes
							NOR = {
								trait = spellsword_1
								trait = spellsword_2
							}
						}
					}
				}
				set_character_flag = dovah_in_society_spellsword
			}
			10 = {
				modifier = {
					factor = 0
					OR = {
						trait = battlemage_3
						AND = {
							has_two_specializations = yes
							NOR = {
								trait = battlemage_1
								trait = battlemage_2
							}
						}
					}
				}
				set_character_flag = dovah_in_society_battlemage
			}
			10 = {
				modifier = {
					factor = 0
					OR = {
						trait = scout_3
						AND = {
							has_two_specializations = yes
							NOR = {
								trait = scout_1
								trait = scout_2
							}
						}
					}
				}
				set_character_flag = dovah_in_society_scout
			}
			10 = {
				modifier = {
					factor = 0
					OR = {
						trait = assassin_3
						AND = {
							has_two_specializations = yes
							NOR = {
								trait = assassin_1
								trait = assassin_2
							}
						}
					}
				}
				set_character_flag = dovah_in_society_assassin
			}
		}
		
		if = {
			limit = {
				calc_true_if = {
					amount = 2
					trait = acrobat_3
					trait = assassin_3
					trait = barbarian_3
					trait = bard_3
					trait = battlemage_3
					trait = crusader_3
					trait = knight_3
					trait = healer_3
					trait = monk_3
					trait = nightblade_3
					trait = priest_3
					trait = rogue_3
					trait = savant_3
					trait = scout_3
					trait = sorcerer_3
					trait = spellsword_3
					trait = thief_3
					trait = trader_3
					trait = wayfarer_3
					trait = witchhunter_3
				}
			}
			clr_character_flag = dovah_in_society_specialization_ongoing
			clr_character_flag = dovah_in_society_assassin
			clr_character_flag = dovah_in_society_barbarian
			clr_character_flag = dovah_in_society_battlemage
			clr_character_flag = dovah_in_society_crusader
			clr_character_flag = dovah_in_society_knight
			clr_character_flag = dovah_in_society_priest
			clr_character_flag = dovah_in_society_rogue
			clr_character_flag = dovah_in_society_scout
			clr_character_flag = dovah_in_society_spellsword
		}
	}
}

character_event = { #Cancel Specilization
	id = dovah_in_soci.220
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		add_character_modifier = {
			name = denied_specialization_timer
			months = 12
			hidden = yes
		}
		
		clr_character_flag = dovah_in_society_specialization_ongoing
		clr_character_flag = dovah_in_society_assassin
		clr_character_flag = dovah_in_society_barbarian
		clr_character_flag = dovah_in_society_battlemage
		clr_character_flag = dovah_in_society_crusader
		clr_character_flag = dovah_in_society_knight
		clr_character_flag = dovah_in_society_priest
		clr_character_flag = dovah_in_society_rogue
		clr_character_flag = dovah_in_society_scout
		clr_character_flag = dovah_in_society_spellsword
	}
}

character_event = { #Guild Specialization Level-Up
	id = dovah_in_soci.230
	desc = EVTDESC_dovah_in_soci.230
	picture = GFX_evt_dragon_temple
	
	is_triggered_only = yes
	
	min_age = 16
	capable_only = yes
	prisoner = no
	
	trigger = {
		society_member_of = dovah_in_society
		OR = {
			has_character_flag = dovah_in_society_assassin
			has_character_flag = dovah_in_society_barbarian
			has_character_flag = dovah_in_society_battlemage
			has_character_flag = dovah_in_society_crusader
			has_character_flag = dovah_in_society_knight
			has_character_flag = dovah_in_society_priest
			has_character_flag = dovah_in_society_rogue
			has_character_flag = dovah_in_society_scout
			has_character_flag = dovah_in_society_spellsword
		}
	}
	
	option = { #Level Up Rogue, Continue Studying
		name = eksocieties100RogueA
		trigger = {
			has_character_flag = dovah_in_society_rogue
			NOR = {
				trait = rogue_2
				trait = rogue_3
			}
		}
		if = {
			limit = {
				NOR = {
					trait = rogue_1
					trait = rogue_2
					trait = rogue_3
				}
			}
			#change variable command removed. DO NOT DELETE THIS
			add_trait = rogue_1
			break = yes
		}
		if = {
			limit = {
				trait = rogue_1
			}
			remove_trait = rogue_1
			add_trait = rogue_2
			break = yes
		}
	}
	option = { #Level Up Rogue, Move On
		name = eksocieties100RogueB
		trigger = {
			has_character_flag = dovah_in_society_rogue
		}
		if = {
			limit = {
				has_maxed_specializations = yes
			}
			clr_character_flag = dovah_in_society_rogue
			break = yes
		}
		if = {
			limit = {
				NOR = {
					trait = rogue_1
					trait = rogue_2
					trait = rogue_3
				}
			}
			#change variable command removed. DO NOT DELETE THIS
			add_trait = rogue_1
			clr_character_flag = dovah_in_society_rogue
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210}
			}
			break = yes
		}
		if = {
			limit = {
				trait = rogue_1
			}
			remove_trait = rogue_1
			add_trait = rogue_2
			clr_character_flag = dovah_in_society_rogue
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210 }
			}
			break = yes
		}
		if = {
			limit = {
				trait = rogue_2
			}
			remove_trait = rogue_2
			add_trait = rogue_3
			clr_character_flag = dovah_in_society_rogue
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210 }
			}
			break = yes
		}
	}
	
	option = { #Level Up Knight, Continue Studying
		name = eksocieties100KnightA
		trigger = {
			has_character_flag = dovah_in_society_knight
			NOR = {
				trait = knight_2
				trait = knight_3
			}
		}
		if = {
			limit = {
				NOR = {
					trait = knight_1
					trait = knight_2
					trait = knight_3
				}
			}
			#change variable command removed. DO NOT DELETE THIS
			add_trait = knight_1
			break = yes
		}
		if = {
			limit = {
				trait = knight_1
			}
			remove_trait = knight_1
			add_trait = knight_2
			break = yes
		}
	}
	option = { #Level Up Knight, Move On
		name = eksocieties100KnightB
		trigger = {
			has_character_flag = dovah_in_society_knight
		}
		if = {
			limit = {
				has_maxed_specializations = yes
			}
			clr_character_flag = dovah_in_society_knight
			break = yes
		}
		if = {
			limit = {
				NOR = {
					trait = knight_1
					trait = knight_2
					trait = knight_3
				}
			}
			#change variable command removed. DO NOT DELETE THIS
			add_trait = knight_1
			clr_character_flag = dovah_in_society_knight
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210}
			}
			break = yes
		}
		if = {
			limit = {
				trait = knight_1
			}
			remove_trait = knight_1
			add_trait = knight_2
			clr_character_flag = dovah_in_society_knight
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210 }
			}
			break = yes
		}
		if = {
			limit = {
				trait = knight_2
			}
			remove_trait = knight_2
			add_trait = knight_3
			clr_character_flag = dovah_in_society_knight
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210 }
			}
			break = yes
		}
	}
	
	option = { #Level Up Crusader, Continue Studying
		name = eksocieties100CrusaderA
		trigger = {
			has_character_flag = dovah_in_society_crusader
			NOR = {
				trait = crusader_2
				trait = crusader_3
			}
		}
		if = {
			limit = {
				NOR = {
					trait = crusader_1
					trait = crusader_2
					trait = crusader_3
				}
			}
			#change variable command removed. DO NOT DELETE THIS
			add_trait = crusader_1
			break = yes
		}
		if = {
			limit = {
				trait = crusader_1
			}
			remove_trait = crusader_1
			add_trait = crusader_2
			break = yes
		}
	}
	option = { #Level Up Crusader, Move On
		name = eksocieties100CrusaderB
		trigger = {
			has_character_flag = dovah_in_society_crusader
		}
		if = {
			limit = {
				has_maxed_specializations = yes
			}
			clr_character_flag = dovah_in_society_crusader
			break = yes
		}
		if = {
			limit = {
				NOR = {
					trait = crusader_1
					trait = crusader_2
					trait = crusader_3
				}
			}
			#change variable command removed. DO NOT DELETE THIS
			add_trait = crusader_1
			clr_character_flag = dovah_in_society_crusader
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210}
			}
			break = yes
		}
		if = {
			limit = {
				trait = crusader_1
			}
			remove_trait = crusader_1
			add_trait = crusader_2
			clr_character_flag = dovah_in_society_crusader
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210 }
			}
			break = yes
		}
		if = {
			limit = {
				trait = crusader_2
			}
			remove_trait = crusader_2
			add_trait = crusader_3
			clr_character_flag = dovah_in_society_crusader
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210 }
			}
			break = yes
		}
	}
	
	option = { #Level Up Barbarian, Continue Studying
		name = eksocieties100BarbarianA
		trigger = {
			has_character_flag = dovah_in_society_barbarian
			NOR = {
				trait = barbarian_2
				trait = barbarian_3
			}
		}
		if = {
			limit = {
				NOR = {
					trait = barbarian_1
					trait = barbarian_2
					trait = barbarian_3
				}
			}
			#change variable command removed. DO NOT DELETE THIS
			add_trait = barbarian_1
			break = yes
		}
		if = {
			limit = {
				trait = barbarian_1
			}
			remove_trait = barbarian_1
			add_trait = barbarian_2
			break = yes
		}
	}
	option = { #Level Up Barbarian, Move On
		name = eksocieties100BarbarianB
		trigger = {
			has_character_flag = dovah_in_society_barbarian
		}
		if = {
			limit = {
				has_maxed_specializations = yes
			}
			clr_character_flag = dovah_in_society_barbarian
			break = yes
		}
		if = {
			limit = {
				NOR = {
					trait = barbarian_1
					trait = barbarian_2
					trait = barbarian_3
				}
			}
			#change variable command removed. DO NOT DELETE THIS
			add_trait = barbarian_1
			clr_character_flag = dovah_in_society_barbarian
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210}
			}
			break = yes
		}
		if = {
			limit = {
				trait = barbarian_1
			}
			remove_trait = barbarian_1
			add_trait = barbarian_2
			clr_character_flag = dovah_in_society_barbarian
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210 }
			}
			break = yes
		}
		if = {
			limit = {
				trait = barbarian_2
			}
			remove_trait = barbarian_2
			add_trait = barbarian_3
			clr_character_flag = dovah_in_society_barbarian
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210 }
			}
			break = yes
		}
	}
	
	option = { #Level Up Spellsword, Continue Studying
		name = eksocieties100SpellswordA
		trigger = {
			has_character_flag = dovah_in_society_spellsword
			NOR = {
				trait = spellsword_2
				trait = spellsword_3
			}
		}
		if = {
			limit = {
				NOR = {
					trait = spellsword_1
					trait = spellsword_2
					trait = spellsword_3
				}
			}
			#change variable command removed. DO NOT DELETE THIS
			add_trait = spellsword_1
			break = yes
		}
		if = {
			limit = {
				trait = spellsword_1
			}
			remove_trait = spellsword_1
			add_trait = spellsword_2
			break = yes
		}
	}
	option = { #Level Up Spellsword, Move On
		name = eksocieties100SpellswordB
		trigger = {
			has_character_flag = dovah_in_society_spellsword
		}
		if = {
			limit = {
				has_maxed_specializations = yes
			}
			clr_character_flag = dovah_in_society_spellsword
			break = yes
		}
		if = {
			limit = {
				NOR = {
					trait = spellsword_1
					trait = spellsword_2
					trait = spellsword_3
				}
			}
			#change variable command removed. DO NOT DELETE THIS
			add_trait = spellsword_1
			clr_character_flag = dovah_in_society_spellsword
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210}
			}
			break = yes
		}
		if = {
			limit = {
				trait = spellsword_1
			}
			remove_trait = spellsword_1
			add_trait = spellsword_2
			clr_character_flag = dovah_in_society_spellsword
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210 }
			}
			break = yes
		}
		if = {
			limit = {
				trait = spellsword_2
			}
			remove_trait = spellsword_2
			add_trait = spellsword_3
			clr_character_flag = dovah_in_society_spellsword
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210 }
			}
			break = yes
		}
	}
	
	option = { #Level Up Priest, Continue Studying
		name = eksocieties100PriestA
		trigger = {
			has_character_flag = dovah_in_society_priest
			NOR = {
				trait = priest_2
				trait = priest_3
			}
		}
		if = {
			limit = {
				NOR = {
					trait = priest_1
					trait = priest_2
					trait = priest_3
				}
			}
			#change variable command removed. DO NOT DELETE THIS
			add_trait = priest_1
			break = yes
		}
		if = {
			limit = {
				trait = priest_1
			}
			remove_trait = priest_1
			add_trait = priest_2
			break = yes
		}
	}
	option = { #Level Up Priest, Move On
		name = eksocieties100PriestB
		trigger = {
			has_character_flag = dovah_in_society_priest
		}
		if = {
			limit = {
				has_maxed_specializations = yes
			}
			clr_character_flag = dovah_in_society_priest
			break = yes
		}
		if = {
			limit = {
				NOR = {
					trait = priest_1
					trait = priest_2
					trait = priest_3
				}
			}
			#change variable command removed. DO NOT DELETE THIS
			add_trait = priest_1
			clr_character_flag = dovah_in_society_priest
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210}
			}
			break = yes
		}
		if = {
			limit = {
				trait = priest_1
			}
			remove_trait = priest_1
			add_trait = priest_2
			clr_character_flag = dovah_in_society_priest
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210 }
			}
			break = yes
		}
		if = {
			limit = {
				trait = priest_2
			}
			remove_trait = priest_2
			add_trait = priest_3
			clr_character_flag = dovah_in_society_priest
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210 }
			}
			break = yes
		}
	}
	
	option = { #Level Up Battlemage, Continue Studying
		name = eksocieties100BattlemageA
		trigger = {
			has_character_flag = dovah_in_society_battlemage
			NOR = {
				trait = battlemage_2
				trait = battlemage_3
			}
		}
		if = {
			limit = {
				NOR = {
					trait = battlemage_1
					trait = battlemage_2
					trait = battlemage_3
				}
			}
			#change variable command removed. DO NOT DELETE THIS
			add_trait = battlemage_1
			break = yes
		}
		if = {
			limit = {
				trait = battlemage_1
			}
			remove_trait = battlemage_1
			add_trait = battlemage_2
			break = yes
		}
	}
	option = { #Level Up Battlemage, Move On
		name = eksocieties100BattlemageB
		trigger = {
			has_character_flag = dovah_in_society_battlemage
		}
		if = {
			limit = {
				has_maxed_specializations = yes
			}
			clr_character_flag = dovah_in_society_battlemage
			break = yes
		}
		if = {
			limit = {
				NOR = {
					trait = battlemage_1
					trait = battlemage_2
					trait = battlemage_3
				}
			}
			#change variable command removed. DO NOT DELETE THIS
			add_trait = battlemage_1
			clr_character_flag = dovah_in_society_battlemage
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210}
			}
			break = yes
		}
		if = {
			limit = {
				trait = battlemage_1
			}
			remove_trait = battlemage_1
			add_trait = battlemage_2
			clr_character_flag = dovah_in_society_battlemage
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210 }
			}
			break = yes
		}
		if = {
			limit = {
				trait = battlemage_2
			}
			remove_trait = battlemage_2
			add_trait = battlemage_3
			clr_character_flag = dovah_in_society_battlemage
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210 }
			}
			break = yes
		}
	}
	
	option = { #Level Up Scout, Continue Studying
		name = eksocieties100ScoutA
		trigger = {
			has_character_flag = dovah_in_society_scout
			NOR = {
				trait = scout_2
				trait = scout_3
			}
		}
		if = {
			limit = {
				NOR = {
					trait = scout_1
					trait = scout_2
					trait = scout_3
				}
			}
			#change variable command removed. DO NOT DELETE THIS
			add_trait = scout_1
			break = yes
		}
		if = {
			limit = {
				trait = scout_1
			}
			remove_trait = scout_1
			add_trait = scout_2
			break = yes
		}
	}
	option = { #Level Up Scout, Move On
		name = eksocieties100ScoutB
		trigger = {
			has_character_flag = dovah_in_society_scout
		}
		if = {
			limit = {
				has_maxed_specializations = yes
			}
			clr_character_flag = dovah_in_society_scout
			break = yes
		}
		if = {
			limit = {
				NOR = {
					trait = scout_1
					trait = scout_2
					trait = scout_3
				}
			}
			#change variable command removed. DO NOT DELETE THIS
			add_trait = scout_1
			clr_character_flag = dovah_in_society_scout
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210}
			}
			break = yes
		}
		if = {
			limit = {
				trait = scout_1
			}
			remove_trait = scout_1
			add_trait = scout_2
			clr_character_flag = dovah_in_society_scout
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210 }
			}
			break = yes
		}
		if = {
			limit = {
				trait = scout_2
			}
			remove_trait = scout_2
			add_trait = scout_3
			clr_character_flag = dovah_in_society_scout
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210 }
			}
			break = yes
		}
	}
	
	option = { #Level Up Assassin, Continue Studying
		name = eksocieties100AssassinA
		trigger = {
			has_character_flag = dovah_in_society_assassin
			NOR = {
				trait = assassin_2
				trait = assassin_3
			}
		}
		if = {
			limit = {
				NOR = {
					trait = assassin_1
					trait = assassin_2
					trait = assassin_3
				}
			}
			#change variable command removed. DO NOT DELETE THIS
			add_trait = assassin_1
			break = yes
		}
		if = {
			limit = {
				trait = assassin_1
			}
			remove_trait = assassin_1
			add_trait = assassin_2
			break = yes
		}
	}
	option = { #Level Up Assassin, Move On
		name = eksocieties100AssassinB
		trigger = {
			has_character_flag = dovah_in_society_assassin
		}
		if = {
			limit = {
				has_maxed_specializations = yes
			}
			clr_character_flag = dovah_in_society_assassin
			break = yes
		}
		if = {
			limit = {
				NOR = {
					trait = assassin_1
					trait = assassin_2
					trait = assassin_3
				}
			}
			#change variable command removed. DO NOT DELETE THIS
			add_trait = assassin_1
			clr_character_flag = dovah_in_society_assassin
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210}
			}
			break = yes
		}
		if = {
			limit = {
				trait = assassin_1
			}
			remove_trait = assassin_1
			add_trait = assassin_2
			clr_character_flag = dovah_in_society_assassin
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210 }
			}
			break = yes
		}
		if = {
			limit = {
				trait = assassin_2
			}
			remove_trait = assassin_2
			add_trait = assassin_3
			clr_character_flag = dovah_in_society_assassin
			if = {
				limit = {
					ai = no
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.200 }
			}
			if = {
				limit = {
					ai = yes
					can_actually_level_up_specialization = yes
				}
				character_event = { id = dovah_in_soci.210 }
			}
			break = yes
		}
	}
}

character_event = { #Buy Tech Points
	id = dovah_in_soci.250
	desc = eksocieties.250.d
	is_triggered_only = yes
	
	picture = GFX_evt_dragon_temple
	
	option = {
		trigger = {
			society_member_of = dovah_in_society
		}
		
		name = eksocieties.250.mil
		military_techpoints = 50
	}
	
	after = {
		# Apply the modifier
		hidden_tooltip = {
			if = {
				limit = { has_character_flag = exchanging_influence_for_tech }
				add_character_modifier = {
					name = society_advancements_purchased
					duration = 3650
				}
				detract_society_currency_major_effect_scaling = yes
				clr_character_flag = exchanging_influence_for_tech
			}
		}
	}
}